containers:
  default:
    build:
      from: ubuntu-latest
      type: ci

# Documentation: https://shopify-build.docs.shopify.io/jobs/publish_packages_to_cloudsmith/
steps:
  - label: Publish to Cloudsmith
    git:
      history: shallow
    run:
      - yarn: ~
      - yarn build
      - |
        for package_dir in gate-context-client connect-wallet tokengate react-tokengating-app; do
          (cd packages/"$package_dir" && yarn pack)
        done
      - mkdir -p ./pkg
      - mv packages/**/*.tgz ./pkg/
      - ls -l ./pkg
    publish:
      package:
        repository_name: node
        package_type: npm
        artifacts:
          - path: pkg
            patterns: ['*.tgz']
